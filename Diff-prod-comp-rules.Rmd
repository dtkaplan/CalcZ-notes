# Differentiation of assembled functions {#prod-comp-rules}

In Chapter \@ref(fun-assembling) we introduced three major methods for putting two or more basic modeling functions together in order to make a new function.

i. Linear combinations: e.g. $a f(x) + b g(x)$
i. Products: e.g. $f(x) g(x)$
i. Composition:, e.g. $f(g(x))$ (which is usually a different function than $g(f(x))$.)

We have already looked at differentiation of linear combinations. In this chapter, we'll examine products of functions and compositions of functions.

## Step 1: Identify f() and g()

We will write the rules in terms of two function names, $f()$ and $g()$, which can stand for any functions whatsoever. It's rare to see the product or the composition written explicitly as $f(x)g(x)$ of $f(g(x))$. Instead, you are given something like $e^x \ln(x)$. The first step in differentiating the product or composition is to identify what are $f()$ and $g()$ individually.  `r mark(2400)`

In general, $f()$ and $g()$ might be complicated functions, themselves involving linear combinations, products, and composition. But to get started, we'll practice with cases where they are simple, naked modeling functions. `r mark(2405)`


```{exercise name="decompose-drill1"}
```
For each of the following, say whether the function is a composition $f(g(x))$ or a product $f(x) g(x)$, or neither. Then identify $f()$. For a product, take $f()$ as the function on the left.

- $h_1(x) \equiv \ln(x) e^x$

```{r dedr1, echo=FALSE, results="markup"}
askMC("What is $h_1(x)$?","+product+", "composition", "neither", random_answer_order=FALSE)
```
```{r dedr1b, echo=FALSE, results="markup"}
askMC("In $h_1()$, which of these is $f(x)$?",
      "$\\sin()$", "$\\cos()$", "$\\exp()$", "+$\\ln()$+", "$\\recip()$",
      "$\\pnorm()$", "$\\dnorm()$", random_answer_order=FALSE)
```

- $h_2(x) \equiv \sin(x) \cos(x)$

<details>
```{r dedr2, echo=FALSE, results="markup"}
askMC("What is $h_2(x)$?","+product+", "composition", "neither", random_answer_order=FALSE)
```
```{r dedr2b, echo=FALSE, results="markup"}
askMC("In $h_2()$, which of these is $f(x)$?",
      "+$\\sin()$+", "$\\cos()$", "$\\exp()$", "$\\ln()$", "$\\recip()$",
      "$\\pnorm()$", "$\\dnorm()$", random_answer_order=FALSE)
```
</details>

- $h_3(x) \equiv \sin(\cos(x))$

<details>
```{r dedr3, echo=FALSE, results="markup"}
askMC("What is $h_3(x)$?","product", "+composition+", "neither", random_answer_order=FALSE)
```
```{r dedr3b, echo=FALSE, results="markup"}
askMC("In $h_3()$, which of these is $f(x)$?",
      "+$\\sin()$+", "$\\cos()$", "$\\exp()$", "$\\ln()$", "$\\recip()$",
      "$\\pnorm()$", "$\\dnorm()$", random_answer_order=FALSE)
```
</details>

- $h_4(x) \equiv e^{\ln(x)}$

<details>
```{r dedr4, echo=FALSE, results="markup"}
askMC("What is $h_4(x)$?","product", "+composition+", "neither", random_answer_order=FALSE)
```
```{r dedr4b, echo=FALSE, results="markup"}
askMC("In $h_4()$, which of these is $f(x)$?",
      "$\\sin()$", "$\\cos()$", "+$\\exp()$+", "$\\ln()$", "$\\recip()$",
      "$\\pnorm()$", "$\\dnorm()$", random_answer_order=FALSE)
```
</details>

- $h_5(x) \equiv \sin(x) - \cos(x)$

<details>
```{r dedr5, echo=FALSE, results="markup"}
askMC("What is $h_5(x)$?","product", "composition", "+neither+", random_answer_order=FALSE)
```
```{r dedr5b, echo=FALSE, results="markup"}
askMC("In $h_5()$, which of these is $f(x)$?",
      "+$\\sin()$+", "$\\cos()$", "$\\exp()$", "$\\ln()$", "$\\recip()$",
      "$\\pnorm()$", "$\\dnorm()$", random_answer_order=FALSE)
```
</details>

- $h_6(x) \equiv e^{x^2}$

<details>
```{r dedr6, echo=FALSE, results="markup"}
askMC("What is $h_2(x)$?","product", "+composition+", "neither", random_answer_order=FALSE)
```
```{r dedr6b, echo=FALSE, results="markup"}
askMC("In $h_6()$, which of these is $f(x)$?",
      "$\\sin()$", "$\\cos()$", "+$\\exp()$+", "$\\ln()$", "$\\recip()$",
      "$\\pnorm()$", "$\\dnorm()$", random_answer_order=FALSE)
```
</details>

- $h_7(x) \equiv \pnorm(x^2)$

<details>
```{r dedr7, echo=FALSE, results="markup"}
askMC("What is $h_7(x)$?","product", "+composition+", "neither", random_answer_order=FALSE)
```
```{r dedr7b, echo=FALSE, results="markup"}
askMC("In $h_7()$, which of these is $f(x)$?",
      "$\\sin()$", "$\\cos()$", "$\\exp()$", "$\\ln()$", "$\\recip()$",
      "+$\\pnorm()$+", "$\\dnorm()$", random_answer_order=FALSE)
```
</details>

- $h_8(x) \equiv \pnorm(x) \dnorm(x)$

<details>
```{r dedr8, echo=FALSE, results="markup"}
askMC("What is $h_8(x)$?","+product+", "composition", "neither", random_answer_order=FALSE)
```
```{r dedr8b, echo=FALSE, results="markup"}
askMC("In $h_8()$, which of these is $f(x)$?",
      "$\\sin()$", "$\\cos()$", "$\\exp()$", "$\\ln()$", "$\\recip()$",
      "+$\\pnorm()$+", "$\\dnorm()$", random_answer_order=FALSE)
```
</details>

- $h_9(x) \equiv 1/\sin(x)$

<details>
```{r dedr9, echo=FALSE, results="markup"}
askMC("What is $h_9(x)$?","product", "+composition+", "neither", random_answer_order=FALSE)
```
```{r dedr9b, echo=FALSE, results="markup"}
askMC("In $h_9()$, which of these is $f(x)$?",
      "$\\sin()$", "$\\cos()$", "$\\exp()$", "$\\ln()$", "+$\\recip()$+",
      "$\\pnorm()$", "$\\dnorm()$", random_answer_order=FALSE)
```
</details>

## Step 2: Find f'() and g'()

For differentiating either products or compositions, you will need to identify both $f()$ and $g()$ (the first step) and then compute the derivatives $\partial_x f()$ and $\partial_x g()$. That is, you'll write down four functions. `r mark(2410)`

```{exercise, name="product-table"}
```
<details>
For each of the $h_i()$ in the previous section, fill in a row of the following table. (The row for $h_1()$ is already entered.)

Name    | $f()$    | $g()$    | $\partial_x f()$  | $\partial_x g()$ 
--------|----------|----------|-------------------|-----------------------
$h_1()$ | $\ln(x)$ | $e^x$ | $\recip$ (that is $1/x$) | $e^x$           
$h_2()$ |          |          |                   |           
$h_3()$ |          |          |                   |           
$h_4()$ |          |          |                   |           
$h_5()$ |          |          |                   |           
$h_6()$ |          |          |                   |           
$h_7()$ |          |          |                   |           
$h_8()$ |          |          |                   |           
$h_9()$ |          |          |                   |           
</details>

## Product rule

Written in terms of the pronoun functions $f()$ and $g()$, the product rule is

::: {.todo}
Decide if colorizing the formulas, as in the following, is helpful and worthwhile.
:::

$$\partial_x \left[\strut \color{blue}{f(x)}\times \color{green}{g(x)}\right] = \color{blue}{[\partial_x f(x)]} \times \color{green}{g(x)}\ \  {\mathbf +}
\ \ \color{green}{[\partial_x g(x)]} \times \color{blue}{f(x)}$$
Some people find it easier to read the rule in Lagrange shorthand, where f and g stand for $f(x)$ and $g(x)$ respectivly, and f' ("f-prime") and g' ("g-prime") stand for $\partial f()$ and $\partial g()$. `r mark(2415)`

$$\text{Lagrange shorthand:}\ \   \partial[f \times g] = [f \times g]' = f'g + g'f$$
Let's start with some very simple examples where we already know the answer:

- $\partial [x \times x^2] = [\partial x] \times x^2 \ +\  [\partial x^2] \times x =1\times x^2 + 2x \times x = 3 x^2$

    Since $[x \times x^2] = x^3$, we could have figured out directly that the derivative is $3 x^2$
    
- $partial_x [e^x \times e^x] = [\partial_x e^x] \times e^x \ + \ [\partial_x e^x] \times e^x = 2 e^x e^x = 2 e^{2x}$

    Since $[e^x \times e^x] = e^{2x}$, one of our basic modeling functions, we could have figured out directly that the derivative is $2 e^{2x}$.


## Composition ("chain") rule

Written in terms of functions $f()$ and $g()$, the rule for the composition $f(g(x))$ is

$$\partial_x \left[\strut \color{blue}{f\left(\right.}\strut \color{green}{g(x)}\color{blue}{\left.\right)}\right] = [\color{blue}{\partial_x f}](\color{green}{g(x)}) \times [\color{green}{\partial_xg(x)}]$$
Or, using the Lagrange prime notation 
$$\text{Lagrange shorthand:}\ \   \partial[f(g)] = f' (g) \times g'$$

This is almost universally called the ***chain rule***, presumably because the result involves a chain of derivatives.

Again, we'll practice with some simple examples where we already know the result:

- $\partial [\exp\left(\ln(x)\right)] = [\partial \exp](\ln(x))  \times \partial_x \ln(x) = \exp\left(\ln(x)\right) \times 1/x$

    Since $\exp\left(\ln(x)\right) = x$ we can simplify the above $$\partial [\exp\left(\ln(x)\right)] = \exp\left(\ln(x)\right) \times 1/x = x/x = 1$$ which is consistent with what we know about $\partial_x x$. `r mark(2420)`

- $\partial[ \recip(x^2)] = [\partial \recip](x^2) \times \partial_x x^2 = [\partial\, \recip](x^2) \times 2 x$  

   Since $\partial_x \recip(x) = \partial_x [1/x] = \partial_x x^{-1} = -x^{-2} = - \frac{1}{x^2}$, we can simplify the above to 
$\partial[ \recip(x^2)] = [\partial_x \recip](x^2) \times \partial_x x^2 =  - \frac{1}{(x^2)^2} \times 2 x = -2 \frac{x}{x^4} = -2 x^{-3}$  


The derivatives of the basic modeling functions can be shown using the chain rule. Remember, that each of the basic modeling functions is the composition of a naked modeling function with $\line(x) \equiv ax + b$.  `r mark(2425)`

- $\partial_x [\sin(a x + b)] = [\partial \sin](a x + b) \times \partial_x [ax + b = \cos(ax + b) \times a$.

## Step 3: Apply the relevant rule

```{exercise, name="product-table-1"}
Go back to the table in the previous section. For those rows involving a product of functions, add a column giving the derivative of the product according to the product rule.
```




::: {.todo}
See 141 DD 31 for drill problems
:::




## Exponentials and logarithms (optional)
    
The ***natural logarithm*** function, $\ln(x)$, is one of our basic modeling functions. The digit() function, introduced in Chapter \@ref(magnitudes) is different, the logarithm-base-10, written $\log_{10}(x)$ or `log10(x)`. Ten an integer, and a nice round number to boot. So in practice, it's "natural" to use $\log_10()$. The "natural" in the "natural logarithm" means something different. `r mark(2430)`

The base of the natural logarithm is the number called ***Euler's constant*** and written $e$. As a celebrity number, $e$ is right up there with $\pi$ and $-1$. Just as $\pi$ has a decimal expansion that is infinitely long, the familiar $\pi = 3.14159265358979...$, Euler's constant has an infinitely long decimal representation: $e = 2.71828182845905...$  `r mark(2435)`

It's not obvious at first glance why $e = 2.71828182845905...$ should be called "natural" by mathematicians. The reason is not the number itself, but 

1. the derivative $\partial_x \ln(x)$ which has a particularly simple form, namely, $1/x$.
2. $\ln(x)$ is the inverse of $e^x$, which itself is the nicest of all derivatives $\partial_x e^x = e^x$.

Let's look at the log-base-10 and it's computer-savvy cousin log-base-2. The very definition of logarithms means that both 10 and 2 can be written $$10 = e^{\ln(10)}\ \ \ \text{and}\ \ \ 2 = e^{\ln(2)}$$
This implies that the base-10 and base-2 exponential functions can be written

$$10^x = [e^{\ln(10)}]^x = e^{\ln(10)x} \ \ \ \text{and}\ \ \ 2^x = [e^{\ln(2)}]^x = e^{\ln(2) x}$$
Calculating $\partial_x 10^x$ or $\partial_x 2^x$ is a matter of applying the chain rule:

$$\partial_x [10^x] = \partial_x [e^{\ln(10)x}] = e^{\ln(10)x} \times \ln(10) = 2.30258509299405... \times 10^x\\ 
\ \text{and}\\
\partial_x [2^x] = \partial_x [e^{\ln(2)x}] = e^{\ln(2)x} \times \ln(2) = 0.693147180559945...\times 2^x$$
Like $e^x$, the derivatives of $10^x$ and $2^x$ are proportional to themselves. For $e^x$ the constant of proportality is 1, a very natural number indeed. 
    



## Checking your work

::: {.todo}
1. When you get the result for a derivative, plot it out along with the finite-difference approximation. If they are close, you're good. 

2. Apply the `antiD()` operator to your derivative and graphically confirm that there is a constant difference between the output of `antiD()` and the original function.
:::




