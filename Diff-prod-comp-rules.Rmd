# Derivs of assembled functions {#prod-comp-rules}

<!-- Standard colors in equations
magenta, brown, darkorange
-->



In Chapter \@ref(fun-assembling) we introduced three major methods for putting two or more basic modeling functions together in order to make a new function.

i. Linear combinations: e.g. $\Large a \color{magenta}{f(x)} + b\, \color{brown}{g(x)}$
i. Products: e.g. $\Large\color{magenta}{f(x)} \color{brown}{g(x)}$
i. Composition:, e.g. $\Large\color{magenta}{f(}{\color{brown}{g(x)}}\color{magenta})$ (which is usually a different function than $g(f(x))$.)

We have already looked at differentiation of linear combinations. In this chapter, we'll examine products of functions and compositions of functions.

## Step 1: Identify f() and g()

We will write the rules in terms of two function names, $f()$ and $g()$, which can stand for any functions whatsoever. It's rare to see the product or the composition written explicitly as $f(x)g(x)$ of $f(g(x))$. Instead, you are given something like $e^x \ln(x)$. The first step in differentiating the product or composition is to identify what are $f()$ and $g()$ individually.  `r mark(2400)`

In general, $f()$ and $g()$ might be complicated functions, themselves involving linear combinations, products, and composition. But to get started, we'll practice with cases where they are simple, pattern-book functions. `r mark(2405)`

`r insert_calcZ_exercise("XX.XX", "3ICCCz", "Exercises/Diff/lamb-rise-sofa.Rmd")`

`r insert_calcZ_exercise("XX.XX", "QFzIOl", "Exercises/Diff/buck-draw-bed.Rmd")`

## Step 2: Find f'() and g'()

For differentiating either products or compositions, you will need to identify both $f()$ and $g()$ (the first step) and then compute the derivatives $\partial_x f()$ and $\partial_x g()$. That is, you'll write down four functions. `r mark(2410)`

`r insert_calcZ_exercise("XX.XX", "jYXYTF", "Exercises/Diff/ant-give-room.Rmd")`




## Product rule

Written in terms of the pronoun functions $f()$ and $g()$, the product rule is


$$\Large\partial_x \left[\strut \color{magenta}{f(x)}\times \color{brown}{g(x)}\right] = \color{magenta}{[\partial_x f(x)]} \times \color{brown}{g(x)}\ \  {\mathbf +}
\ \ \color{magenta}{[\partial_x g(x)]} \times \color{brown}{f(x)}$$
Some people find it easier to read the rule in Lagrange shorthand, where f and g stand for $f(x)$ and $g(x)$ respectivly, and f' ("f-prime") and g' ("g-prime") stand for $\partial f()$ and $\partial g()$. `r mark(2415)`

$$\Large\text{Lagrange shorthand:}\ \   \partial[\color{magenta}f \times \color{brown}g] = [\color{magenta}f \times \color{brown}g]' = \color{magenta}{f'}\color{brown}g + \color{brown}{g'}\color{magenta}f$$
Let's start with some very simple examples where we already know the answer:

- We know $\partial_x x^3 = 3 x^2$ so lets check when we write $x^3$ as $x^2 x$:
$$\large\partial [\color{magenta}x \times \color{brown}{x^2}] = \color{magenta}{[\partial x]} \times \color{brown}{x^2} \ +\  \color{brown}{[\partial x^2]} \times \color{magenta}x =\color{magenta}1\times \color{brown}{x^2} + \color{brown}{2x} \times \color{magenta}x = 3 x^2$$

- We know that $e^x \times e^x = e^{2x}$ so $\partial_x [e^x \times e^x] = 2 e^{2x}$. Let's check this against the product rule's result:
    
$partial_x [\color{magenta}{e^x} \times \color{brown}{e^x}] = \color{magenta}{[\partial_x e^x]} \times \color{brown}{e^x} \ + \ \color{brown}{[\partial_x e^x]} \times \color{magenta}{e^x} = 2 e^x e^x = 2 e^{2x}$




## Composition ("chain") rule

Written in terms of functions $f()$ and $g()$, the rule for the composition $f(g(x))$ is

$$\Large\partial_x \left[\strut \color{magenta}{f\left(\strut\right.}\strut \color{brown}{g(x)}\color{magenta}{\left.\right)}\right] = [\color{magenta}{\partial_x f}](\color{brown}{g(x)}) \times [\color{brown}{\partial_xg(x)}]$$
Or, using the Lagrange prime notation 
$$\large\text{Lagrange shorthand:}\ \   \partial[\color{magenta}f(\color{brown}g)] = \color{magenta}{f'} (\color{brown}g) \times \color{brown}{g'}$$

This is almost universally called the ***chain rule***, presumably because the result involves a chain of derivatives.

Again, we'll practice with some simple examples where we already know the result:

- $\partial [\exp\left(\ln(x)\right)] = [\partial \exp](\ln(x))  \times \partial_x \ln(x) = \exp\left(\ln(x)\right) \times 1/x$

    Since $\exp\left(\ln(x)\right) = x$ we can simplify the above $$\partial [\exp\left(\ln(x)\right)] = \exp\left(\ln(x)\right) \times 1/x = x/x = 1$$ which is consistent with what we know about $\partial_x x$. `r mark(2420)`

- $\partial[ \recip(x^2)] = [\partial \recip](x^2) \times \partial_x x^2 = [\partial\, \recip](x^2) \times 2 x$  

   Since $\partial_x \recip(x) = \partial_x [1/x] = \partial_x x^{-1} = -x^{-2} = - \frac{1}{x^2}$, we can simplify the above to 
$\partial[ \recip(x^2)] = [\partial_x \recip](x^2) \times \partial_x x^2 =  - \frac{1}{(x^2)^2} \times 2 x = -2 \frac{x}{x^4} = -2 x^{-3}$  

The chain rule lets us use what we know about the derivatives of the pattern-book functions to figure out the derivatives of the basic modeling functions. Remember, that each of the basic modeling functions is the composition of a pattern-book function with $\line(x) \equiv ax + b$.  `r mark(2425)`

- $\large\partial_x [\color{brown}\sin(\color{magenta}{a x + b})] = [\partial_x \color{brown}{\sin}](\color{magenta}{a x + b}) \times \partial_x [\color{magenta}{ax + b}] = \color{brown}{\cos}(\color{magenta}{ax + b}) \times \color{magenta}a$.

## Step 3: Apply the relevant rule

`r insert_calcZ_exercise("XX.XX", "YbPAf1", "Exercises/Diff/sheep-draw-clock.Rmd")`

::: {.todo}
See 141 DD 31 for drill problems
:::




## Exponentials and logarithms (optional)
    
The ***natural logarithm*** function, $\ln(x)$, is one of our basic modeling functions. The digit() function, introduced in Chapter \@ref(magnitudes) is different, the logarithm-base-10, written $\log_{10}(x)$ or `log10(x)`. Ten an integer, and a nice round number to boot. So in practice, it's "natural" to use $\log_10()$. The "natural" in the "natural logarithm" means something different. `r mark(2430)`

The base of the natural logarithm is the number called ***Euler's constant*** and written $e$. As a celebrity number, $e$ is right up there with $\pi$ and $-1$. Just as $\pi$ has a decimal expansion that is infinitely long, the familiar $\pi = 3.14159265358979...$, Euler's constant has an infinitely long decimal representation: $e = 2.71828182845905...$  `r mark(2435)`

It's not obvious at first glance why $e = 2.71828182845905...$ should be called "natural" by mathematicians. The reason is not the number itself, but 

1. the derivative $\partial_x \ln(x)$ which has a particularly simple form, namely, $1/x$.
2. $\ln(x)$ is the inverse of $e^x$, which itself is the nicest of all derivatives $\partial_x e^x = e^x$.

Let's look at the log-base-10 and it's computer-savvy cousin log-base-2. The very definition of logarithms means that both 10 and 2 can be written $$10 = e^{\ln(10)}\ \ \ \text{and}\ \ \ 2 = e^{\ln(2)}$$
This implies that the base-10 and base-2 exponential functions can be written

$$10^x = [e^{\ln(10)}]^x = e^{\ln(10)x} \ \ \ \text{and}\ \ \ 2^x = [e^{\ln(2)}]^x = e^{\ln(2) x}$$
Calculating $\partial_x 10^x$ or $\partial_x 2^x$ is a matter of applying the chain rule:

$$\partial_x [10^x] = \partial_x [e^{\ln(10)x}] = e^{\ln(10)x} \times \ln(10) = 2.30258509299405... \times 10^x\\ 
\ \text{and}\\
\partial_x [2^x] = \partial_x [e^{\ln(2)x}] = e^{\ln(2)x} \times \ln(2) = 0.693147180559945...\times 2^x$$
Like $e^x$, the derivatives of $10^x$ and $2^x$ are proportional to themselves. For $e^x$ the constant of proportality is 1, a very natural number indeed. 
    



## Checking your work

::: {.todo}
1. When you get the result for a derivative, plot it out along with the finite-difference approximation. If they are close, you're good. 

2. Apply the `antiD()` operator to your derivative and graphically confirm that there is a constant difference between the output of `antiD()` and the original function.
:::




