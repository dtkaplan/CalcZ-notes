# Slope function {#fun-slopes}

For our purposes, the ***definition of calculus*** is

> *The use of functions to model and explore continuous change*

The agenda of this chapter is to give specific mathematical meaning to the word "change."

## Change and slope

You have an solid, intuitive sense of what "change" means. In mathematics, and especially the mathematics of functions, change has a very simple meaning that you have already touched on in your previous math education.

The word that encapsulates "change" in high-school math is ***slope***. For instance, you've undoubtedly had to calculate the slope of a straight line in a graph. You learned about "rise" and "run" and how to read them from a graph or from a formula. The slope is the ratio: rise over run. 

Slope is a lovely ***metaphor*** for change, since everyone has a intuitive sense of the slope of a road or of a hillside. You learned to apply this intuition to reading graphs and the slope of a line. We'll exploit the intuitive ability to read a landscape in order to introduce abstract mathematical ideas in a down-to-earth setting. It's a very effective pedagogical strategy.

But not everything that changes has a "slope." For instance, the population of a country can change, as can the number of new cases of an epidemic disease, the temperature of a cup of coffee, or the distance from Earth of a spacecraft. A major part of learning calculus is generalizing and abstracting the mathematical concept of which "slope" is an example and becoming proficient with mathematical procedures for working with change. 

## Continuous change

Most people are comfortable with the ideas of daily changes in temperature or monthly changes in credit-card debt or quarterly changes in the unemployment rate or annual changes in the height of a child. Such things are easy to record in, say, a spreadsheet. For example, as I write, the weather forecast for the next several days (in southeastern Colorado in mid-May) is

Day | High | Low | Description
----|------|-----|------------
Thursday | 73 | 43 | sunny
Friday   | 72 | 48 | windy
Saturday | 66 | 48 | thunderstorms
Sunday   | 68 | 43 | windy
Monday   | 70 | 39 | sunny
Tuesday  | 70 | 43 | sunny
Wednesday| 66 | 45 | partly cloudy

Such data is said to be ***discrete***. The day is listed, but not the time of day. The high temperature is forecast, but not the time of that high. The "description" is also discrete, one of the several words that are used to summarize the quality of the weather, as opposed to the quantity of rain. 

Calculus is about ***continuous change***. For instance, if the weather bureau provide a web interface that let me enter the date and time to the nearest fraction of a second, they would be giving a way to track the change ***continuously***. Many physical processes are intrinsically continuous, for instance the motion (change in position) of a spacecraft or the height of the tide or the stress on a tree as a function of wind velocity.

Finding a language to describe continuous change---famously, the position of the moon or planets in their orbit, or the speed of a ball rolling down a ramp---was central to the emergence of what historians call the "Age of Enlightenment" or "modern scientific method." The first complete presentation of that language was published by Isaac Newton based on his work in the 1660s. As you might guess, the name of the language is "calculus."

## Slope

You already know pretty much everything there is to know about the straight-line function,

- **Formula**: $f(x) \equiv a x + b$. The parameters $a$ and $b$ are the "slope" and "intercept" respectively. (More precisely, $b$ is the "y-intercept." But in statistics and modeling, it's just the "intercept.")
- **Reading parameters from a graph**: You learned several ways to do this which are all equivalent. Maybe the easiest is the read the y-intercept off the graph. That's $b$. Then choose some non-zero $x_1$ and read off from the graph the value of $f(x_1)$. The slope is simply $$\frac{f(x_1) - b}{x_0}$$

    The ***y-intercept method*** is a special case of a more general method, the ***two-point method***, that you can use even if the y-intercept isn't shown on the graph. Pick two specific values of $x$, which we'll call $x_0$ and $x_1$. Evalate the function at these input values and compute the rise over run: $$\mbox{rise over run} \equiv \frac{f(x_1) - f(x_0)}{x_1 - x_0}$$
The rise over run is the slope of the straight line.

    The y-intercept method is exactly the same as the two-point method with $x_0 = 0$.
    
- **Matching a straight-line function to data**: You might not have been taught this formally, but the basic process is easy to imitate. The process is called ***line fitting*** or, in statistics and other fields, ***linear regression***.

## The fitted line

::: {.objectives}
```{r echo=FALSE, results="asis"}
state_objective("Fun-4-a-1", "Construct a straight-line model that fits data.")
```
:::



To illustrate line fitting, let's return to the cooling mug of water. Figure \@ref(fig:Fun-4-a) shows the data along with a dozen candidate straight line functions, each one drawn in its own color.

```{r Fun-4-a, echo=FALSE, warning=FALSE, fig.cap="Some candidate straight-line function models plotted on top of the cooling water data. Which one(s) would you pick as good matches to the data?"}
set.seed(101)
gf_point(temp ~ time, data=CoolingWater %>% sample_n(20)) %>%
  gf_labs(x = "Time (minutes)", y="Temperature (deg. C)") %>%
  gf_lm(temp ~ time, data = CoolingWater %>% sample_n(20), color="blue") %>%
  gf_lm(temp ~ time, data = CoolingWater %>% sample_n(20), color="aquamarine") %>%
  gf_lm(temp ~ time, data = CoolingWater %>% sample_n(20), color="cadetblue") %>%
  gf_lm(temp ~ time, data = CoolingWater %>% sample_n(20), color="green") %>%
  gf_lm(temp ~ time, data = CoolingWater %>% sample_n(20), color="cadetblue") %>%
  gf_lm(temp ~ time, data = CoolingWater %>% sample_n(20), color="royalblue") %>%
  gf_lm(temp ~ time, data = CoolingWater %>% sample_n(20),color="seagreen") %>%
  gf_abline(intercept = 100, slope=-0.21, color = "plum") %>%
  gf_abline(intercept = 90, slope=-0.19, color = "plum3") %>%
  gf_abline(intercept = 63, slope=-0.05, color = "purple") %>%
  gf_abline(intercept = 120, slope=-0.51, color = "purple3") %>%
  gf_abline(intercept = 7, slope=.21, color = "orchid")
```

Some of the straight-line models are a much better match to the data than others. The blue-shaded functions are pretty good fits, the greenish functions are maybe OK but a little sketchy, and the purple-shaded functions are just horrible.

Now that you know what a reasonable straight-line model looks like, you will find it pretty easy to draw one on data graphics that even remotely show a straight-line pattern. 

Step 1: Draw a reasonable straight-line through the data points. 

Step 2: Find the parameters that correspond to the line you drew. 

## Average rate of change

Since the slope is our standard way of representing a relationship of change, we will often use it as a way of summarizing a function. To illustrate, consider the exponential model we constructed to match the cooling-water data:

```{r}
water <- makeFun(60.7*exp(-0.019*t) + 25.93 ~ t)
```



```{r water-average, echo=FALSE, fig.cap="The exponential function that was previously matched to the cooling-water data. The slope of the straight line connecting two points on the function graph is the average rate of change during the interval."}

Pts <- tibble::tibble(
  t = c(10,125),
  y = water(t),
  baselabel = c("t[0]", "t[1]"),
  flabel = c("f(t[0])", "f(t[1])")
)
slice_plot(water(t) ~ t, domain(t = c(0,200))) %>%
  gf_point(y ~ t, data = Pts, color="red", alpha=0.25, size=4) %>%
  gf_line(y ~ t, data = Pts, color="red") %>%
  gf_point(0 ~ t, data = Pts, color="blue", alpha=0.25, size=4) %>%
  gf_lims(y=c(0,90)) %>%
  gf_segment(0 + y ~ t+t, data=Pts, color="blue", linetype=2) %>%
  gf_text(0 ~ t, data = Pts, label = ~baselabel, color="blue", nudge_x=7, parse=TRUE) %>%
  gf_text(y ~ t, data = Pts, label = ~flabel, color="red", nudge_y=7, nudge_x=2, parse=TRUE)
```

During the interval $[t_0, t_1]$ the rate at which the water cools is higher at first and lower at the end. The ***average*** rate of change is a single number that summarizes the whole interval.

For all except straight-line models, the average rate of change depends on the interval chosen.

```{exercise, name="snail-tear-blanket"}
```
<details>`r MC_counter$reset()` `r knitr::knit_child("Exercises/Fun/snail-tear-blanket.Rmd")`</details>


```{exercise, name="goat-dive-saucer"}
```
<details>`r MC_counter$reset()` `r knitr::knit_child("Exercises/Fun/goat-dive-saucer.Rmd")`</details>

```{exercise, name="chicken-show-map"}
```
<details>`r MC_counter$reset()` `r knitr::knit_child("Exercises/Fun/chicken-show-map.Rmd")`</details>


```{exercise, name="eagle-bring-car"}
```
<details>`r MC_counter$reset()` `r knitr::knit_child("Exercises/Fun/eagle-bring-car.Rmd")`</details>

```{exercise, name="pig-look-rug"}
```
<details>`r MC_counter$reset()` `r knitr::knit_child("Exercises/Fun/pig-look-rug.Rmd")`</details>







In Block 2, we'll see that a good way to define an instantaneous rate of change at $t_0$ is as the average rate of change over the interval $t_0 \leq t \leq t_1$ with the proviso that the interval length $t_1 - t_0$ goes as closely as it can to zero.


::: {.intheworld}
"Slope" is a natural metaphor when thinking of a function as a graph. But a more general way to describe the concept is the ***rate of change*** of the output with respect to the input. The change in the output from one end of the interval  is $f(x_1) - f(x_0)$, the change in the input is $x_1 - x_0$. If the input is time (in hours), and the output is the position of a car (in miles), then the rate of change is *miles-per-hour*: the car's velocity.

For a straight-line function---think of a car driving at constant speed on a highway---it doesn't matter what you choose for $x_1$ and $x_0$ (so long as they are not identical). But for other functions, the choice does matter.

Imagine a graph of the position of a car along a road as in Figure \@ref{fig:stop-and-go}. Over the course of an hour, the car travelled about 25 miles. In other words, the ***average*** speed is 25 miles/hour: the *slope* of the red line segment. Given the traffic, sometimes the car was stopped (time C), sometimes crawling (time D) and sometimes much faster than average (time B).  

```{r stop-and-go, echo=FALSE}
f <- rfun(~ t, seed=105, n=5)
raw <- function(t) 
        f(t) - t - 30*dnorm(t, 0, 3) + 60*dnorm(t,7,1)
speed <- function(t) {
    pmax(4*raw(20*(t-.5)), 0)
}
position <- antiD(speed(t) ~ t)
Pts <- tibble::tibble(
    t = c(0, 0.19, 0.4, 0.54, 0.65, 1),
    y = position(t) + 2,
    label=c("", "A", "B", "C", "D", "")
)
Intervals <- tibble::tribble(
    ~t0, ~ t1, ~color,
    0, 1, "red",
    .54, .65, "orange",
    .19, .4, "green",
    .4, .54, "brown",
) %>%
    mutate(y0=position(t0), y1=position(t1))
slice_plot(position(t) ~ t, domain(t = c(0, 1)), size=2) %>%
    gf_labs(y = "x(t): Position from start of trip (miles)",
            x = "Time since start (hours)") %>%
    gf_text(0 ~ t, data = Pts, label=~label, color="blue") %>%
    gf_segment(2 + y ~ t + t, data = Pts[-6,], color="blue") %>%
    gf_segment(y0 + y1 ~ t0 + t1, data = Intervals, color=~color, alpha=0.5, size=3) %>%
    gf_refine(scale_color_identity())
```

During the interval from B to C, the car was travelling relatively fast. The slope of the brown segment connecting the position at times B and C is the ***average*** rate of change between times B and C. It's easy to see that the average rate of change from B to C is larger than the overall average from $t=0$ to $t=1$. Calculating that slope is a matter of evaluating the position at the endpoints and dividing by the length of the interval.

::: {.workedexample latex-data=""}
What is the average rate of change in the car's position during the interval $t_B = 0.40$ to $t_C=0.54$?

The length of the interval is $t_C - t_B = 0.54-0.40=0.14$.

Evaluating the function gives $x(t_C) = 18$ and $x(t_B) = 12.6$. 

Rise is $x(t_C) - x(t_B) = 18 - 12.6 = 5.4$.

Run is $t_C - t_B = 0.54-0.40=0.14$.

The average rate of change during the interval is $5.4/0.14 = 38.6 $ miles/hour.
:::

```{exercise, name="lion-find-bowl"}
```
<details>`r MC_counter$reset()` `r knitr::knit_child("Exercises/Fun/lion-find-bowl.Rmd")`</details>


## Instantaneous rate of change {#instantaneous-rate-of-change}

The water is cooling continuously. Sometimes we'll be interested in the rate of change at a given instant $t_0$. It's straightforward to make out what the instantaneous rate of change will be on a graph: the slope of the line tangent to the curve at $t_0$, as in Figure \@ref(fig:tangent-line-exp). 

```{r tangent-line-exp, echo=FALSE, fig.cap="A line tangent to a the curve at a single point. The slope of this line is the instantaneous rate of change."}
Pt <- tibble::tibble(
  t = 25,
  y = water(t),
  baselabel="t[0]",
  flabel = "f(t[0])"
)
tangent <- makeFun(-0.71722*(t-25) + 63.7 ~ t)
slice_plot(water(t) ~ t, domain(t=c(0, 65)), size=3, alpha=.25) %>%
  gf_point(y ~ t, data=Pt, 
           color="sienna", alpha = 0.25, size=4) %>%
  gf_point(25 ~ t, data=Pt, 
           color="tomato", alpha = 0.25, size=4) %>%
  slice_plot(tangent(t) ~ t, color = "sienna", 
             domain(t=c(0,65))) %>%
  gf_text(y ~ t, data = Pt, label = ~ flabel, 
          nudge_x = 3, color="sienna", parse=TRUE) %>%
  gf_text(25 ~ t, data = Pt, label = ~ baselabel, 
          nudge_x = 3, color="tomato", parse=TRUE) %>%
  gf_segment(25 + y ~ t+t, data=Pt, color="tomato", linetype=2)
```
It's convenient to be able to find the slope of such a tangent line using just the definition $f(t)$, rather than having to draw a graph and eyeball the tangent. For now, let's approximate the slope of tangent line by the average rate of change over a small run from  $t_0$ to $t_0 + 0.1$:
$$\text{slope of}\ f(t) \ \text{at}\ t_0 \approx\frac{f(t_0 + 0.1) - f(t_0)}{0.1} = \frac{\text{amount of rise}}{\text{length of run}}$$
The $\approx$ symbol means "is approximately." For now, I want to put off the question of what "approximately" means. In modeling, whether the 0.1 gives a good enough approximation will depend on the function $f()$ and the context in which the slope is needed. For instance, in drawing Figure \@ref(fig:tangent-line-exp) I needed to find the tangent line. Using 0.1 is entirely satisfactory in this setting but it might not be in other settings.

The notation "slope of $f(t)$ at $t_0$" is long-winded and awkward. If we were looking at the "value of $f(t)$ at $t_0$ we have at hand a much more concise notation: $f(t_0)$. But it doesn't work to write "slope of $f(t_0)$" because $f(t_0)$ is a **quantity** and not a **function**. Instead, let's make a concise notation for "slope of $f(t)$." Following tradition, we'll write ${\cal D}f(t)$. The name of this "slope of $f(t)$" function is ${\cal D}f()$: a two-letter name. When we want to say, "the (approximate) slope of the tangent line to $f(t)$ at $t_0$, we can write simply: $${\cal D}f(t_0)$$
meaning, evaluate the "slope function of f()" at $t_0$.

To formalize this, we'll define the ***slope function of f()*** as 
$${\cal D}f(t) \equiv \frac{f(t + 0.1) - f(t)}{0.1}$$
Let's look at the slope functions that correspond to some of naked modeling functions: $e^x$, $\sin(x)$, $x^{-1}$ and $\ln(x)$. We can define them easily enough in R:

```{r}
Dexp <- makeFun((exp(t+0.1) - exp(t))/0.1 ~ t)
Dsin <- makeFun((sin(t+0.1) - sin(t))/0.1 ~ t)
Dxm1 <- makeFun(((1/(t+0.1)) - (1/t))/0.1 ~ t)
Dlog <- makeFun((log(t+0.1) - log(t))/0.1 ~ t)
```


```{r compare-naked-slopes, echo=FALSE, out.width="50%", fig.show="hold", fig.cap="Comparing the naked modeling function (blue) to it's slope function (red)",warning=FALSE}
slice_plot(sin(x) ~ x, domain(x=c(-10,10)), color="blue") %>%
  slice_plot(Dsin(x) ~ x, color="red", alpha=0.25, size=2) %>%
  gf_labs(title="Sinusoid")
slice_plot(exp(x) ~ x, domain(x=c(-2,2)), color="blue") %>%
  slice_plot(Dexp(x) ~ x, color="red", alpha=0.25, size=2) %>%
  gf_labs(title="Exponential function")
slice_plot(log(x) ~ x, domain(x=c(0.1,5)), color="blue") %>%
  slice_plot(Dlog(x) ~ x, color="red", alpha=0.25, size=2) %>%
  gf_labs(title="Logarithm function") %>%
  gf_lims(y=c(-2.5, 7.5))
slice_plot(1/x ~ x, domain(x=c(0.1,5)), color="blue", npts=500) %>%
  slice_plot(Dxm1(x) ~ x, color="red", alpha=0.25, size=2) %>%
  gf_labs(title="Power law function (with p=-1)") %>%
  gf_lims(y=c(-2.5, 7.5))
```

```{exercise, name="slope-web-1"}
```
<details>`r MC_counter$reset()` `r knitr::knit_child("Exercises/Fun/slope-web-1.Rmd")`</details>


::: {.why}
Why did you plot both the function and the slope function in the same graphics frame?

Excellent question! In general, it is illegitimate to plot a function and it's slope function on the same vertical axis. The reason is the units of the two functions will be different. For instance, the output of a function position(t) might have units of "miles," while the output of the slope function of position (that is, ${\cal D}$position(t) would have units such as miles-per-hour.)  So, as a general rule, never plot a function and its corresponding slope function on the same scale. 

An exception is for the naked modeling functions. These always take a number as input and produce a number as output. The slope function of a naked modeling function also produces a number as output. 

This exception is not a good excuse for indulging a bad practice. Perhaps you'll forgive me if I point out that I wanted to emphasize the point by demonstrating it.
:::

::: {.takenote}
I've been writing the slope function of $f(t)$ as ${\cal D}f(t)$. That works for this chapter, which deals with functions of only one variable. But in general modeling functions have more than one variable, for instance $g(x, t)$. To work with slope functions with more than one variable, we need to extend the notation a little. We will place a small subscript after ${\cal D}$ to indicate which variable we are changing. Thus, there will be two slope functions for $g(x,t)$:
$$\require{color}{\cal D}_{\color{blue}x} g(x, t) \equiv \frac{g({\color{blue}x + 0.1}, t) - g(x, t)}{0.1}\\
\text{and}\\
{\cal D}_{\color{red}t} g(x, t) \equiv \frac{g(x, {\color{red}t + 0.1}) - g(x, t)}{0.1}$$
The input referred to in the subscript following ${\cal D}$ is called the ***with-respect-to input***.
:::

```{exercise, name="tree-harvesting"}
This exercise is misplaced and unfinished.
```

<details>`r MC_counter$reset()` `r knitr::knit_child("Exercises/Diff/tree-harvesting.Rmd")`</details>


```{exercise, name="slope-functions"}
Calculate the slope function of the naked sigmoidal function. What is its value at x=0. Do some other functions as well.

Also, some where we change the 0.1 to something smaller.

Maybe a "What is small?" `{.intheworld}`
```

